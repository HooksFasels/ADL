generator client {
  provider        = "prisma-client"
  output          = "../generated/prisma"

}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  ADMIN
  DRIVER
  OPERATOR
}

enum VehicleStatus {
  ACTIVE
  INACTIVE
  MAINTENANCE
}

enum TripStatus {
  SCHEDULED
  RUNNING
  COMPLETED
  CANCELLED
}

model User {
  id       String   @id @default(uuid())
  email    String   @unique
  password String
  role     UserRole
  isActive Boolean  @default(true)
  name     String

  driverProfile DriverProfile?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  @@index([role])
}

model DriverProfile {
  id        String  @id @default(uuid())
  userId    String  @unique
  phone     String?
  licenseNo String?

  user User @relation(fields: [userId], references: [id])

  vehicles VehicleAssignment[]

  createdAt DateTime @default(now())
}

model Vehicle {
  id           String        @id @default(uuid())
  registration String        @unique
  type         String
  capacity     Int?
  status       VehicleStatus @default(ACTIVE)

  assignments VehicleAssignment[]
  trips       Trip[]
  locations   LocationHistory[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Route {
  id       String  @id @default(uuid())
  code     String  @unique
  name     String
  city     String
  isActive Boolean @default(true)

  stops       RouteStop[]
  trips       Trip[]
  assignments VehicleAssignment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([city])
}

model RouteStop {
  id        String @id @default(uuid())
  routeId   String
  name      String
  latitude  Float
  longitude Float
  sequence  Int

  route Route @relation(fields: [routeId], references: [id])

  @@unique([routeId, sequence])
  @@index([routeId])
}

model VehicleAssignment {
  id        String @id @default(uuid())
  vehicleId String
  driverId  String
  routeId   String

  vehicle Vehicle       @relation(fields: [vehicleId], references: [id])
  driver  DriverProfile @relation(fields: [driverId], references: [id])
  route   Route         @relation(fields: [routeId], references: [id])

  startDate DateTime
  endDate   DateTime?

  @@index([vehicleId])
  @@index([driverId])
  @@index([routeId])
}

model Trip {
  id        String     @id @default(uuid())
  vehicleId String
  routeId   String
  status    TripStatus

  startedAt DateTime?
  endedAt   DateTime?

  vehicle Vehicle @relation(fields: [vehicleId], references: [id])
  route   Route   @relation(fields: [routeId], references: [id])

  locations LocationHistory[]

  @@index([vehicleId])
  @@index([routeId])
}

model LocationHistory {
  id         String   @id @default(uuid())
  vehicleId  String
  tripId     String?
  latitude   Float
  longitude  Float
  speed      Float?
  recordedAt DateTime @default(now())

  vehicle Vehicle @relation(fields: [vehicleId], references: [id])
  trip    Trip?   @relation(fields: [tripId], references: [id])

  @@index([vehicleId, recordedAt])
  @@index([tripId])
}
